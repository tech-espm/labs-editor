<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt-br" dir="ltr">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=1024, initial-scale=1" />

	<meta property="og:locale" content="pt_BR" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://tech-espm.github.io/labs-editor/html/" />
	<meta property="og:title" content="Editor (HTML)" />
	<meta property="og:site_name" content="Editor (HTML)" />
	<meta property="og:description" content="Editor HTML + CSS para uso em sala de aula." />
	<!--
	<meta property="og:image" content="fb.jpg" />
	<meta property="og:image:type" content="image/jpeg">
	<meta property="og:image:width" content="768">
	<meta property="og:image:height" content="768">
	-->

	<meta name="author" content="ESPM TECH" />
	<meta name="description" content="Editor HTML + CSS para uso em sala de aula." />
	<meta name="keywords" content="html, css, editor, wysiwyg" />

	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="apple-mobile-web-app-title" content="Editor (HTML)" />
	<!--
		https://w3c.github.io/manifest/#icon-masks
		https://github.com/w3c/manifest/issues/555
	-->
	<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-icon-57x57.png" />
	<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-icon-60x60.png" />
	<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-icon-72x72.png" />
	<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-icon-76x76.png" />
	<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-icon-114x114.png" />
	<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-icon-120x120.png" />
	<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-icon-144x144.png" />
	<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-icon-152x152.png" />
	<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-icon-180x180.png" />
	<link rel="icon" type="image/png" sizes="512x512" href="../favicons/favicon-512x512.png" />
	<link rel="icon" type="image/png" sizes="192x192" href="../favicons/favicon-192x192.png" />
	<link rel="icon" type="image/png" sizes="96x96" href="../favicons/favicon-96x96.png" />
	<link rel="icon" type="image/png" sizes="48x48" href="../favicons/favicon-48x48.png" />
	<link rel="icon" type="image/png" sizes="32x32" href="../favicons/favicon-32x32.png" />
	<link rel="icon" type="image/png" sizes="16x16" href="../favicons/favicon-16x16.png" />
	<link rel="Shortcut Icon" href="../favicon.ico" />
	<link rel="Shortcut Icon" href="../favicon.png" />
	<link rel="manifest" href="../manifest-html.json" />
	<meta name="msapplication-config" content="../browserconfig.xml" />
	<meta name="theme-color" content="#222222" />

	<title>Editor (HTML)</title>

	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,600|Roboto+Mono:400,700" />
	<link rel="stylesheet" href="../lib/bootstrap/css/bootstrap-1.0.22.min.css" />
	<link rel="stylesheet" href="../lib/font-awesome/css/font-awesome-1.0.2.min.css" />
	<link rel="stylesheet" href="../css/style.css" />
</head>
<body style="visibility: hidden">

	<div class="modal fade" tabindex="-1" role="dialog" id="modalSave">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" data-string="aria-label|Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" data-string="text|Save"></h4>
				</div>
				<div class="modal-body">
					<div class="form-group">
						<label for="modalSaveFileName" data-string="text|FileName"></label>
						<input type="text" class="form-control" id="modalSaveFileName" spellcheck="false" autocomplete="off" />
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-outline btn-default" data-dismiss="modal" data-string="text|Cancel"><i class="fa fa-margin fa-times"></i></button>
					<button type="button" class="btn btn-primary" id="modalSaveOk" data-string="text|Save"><i class="fa fa-margin fa-check"></i></button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" tabindex="-1" role="dialog" id="modalLibraries">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" data-string="aria-label|Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" data-string="text|Libraries"></h4>
				</div>
				<div class="modal-body">
					<textarea class="form-control monospace" id="modalLibrariesText" spellcheck="false" rows="20" wrap="off">&lt;!-- jQuery --&gt;
&lt;script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"&gt;&lt;/script&gt;

&lt;!-- Bootstrap 3 --&gt;
&lt;link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" /&gt;
&lt;script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"&gt;&lt;/script&gt;

&lt;!-- Bootstrap 4 --&gt;
&lt;link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" /&gt;
&lt;script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"&gt;&lt;/script&gt;

&lt;!-- Font Awesome 4.7 --&gt;
&lt;link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css /&gt;

&lt;!-- jQuery Validate 1.19 --&gt;
&lt;script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.1/jquery.validate.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.1/additional-methods.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.1/localization/messages_pt_BR.min.js"&gt;&lt;/script&gt;
</textarea>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-outline btn-default" data-dismiss="modal" data-string="text|Close"><i class="fa fa-margin fa-times"></i></button>
				</div>
			</div>
		</div>
	</div>

	<div class="editor-container" id="editorContainer">
		<a class="nav-tabs-logo" href="https://github.com/tech-espm/labs-editor" target="_blank"><img width="75" src="../images/logo.png" style="border: none;" /></a>
		<div class="nav-tabs-buttons">
			<button type="button" id="editorPlay" class="btn btn-success btn-outline dropdown-toggle" data-string="title|PreviewPage">
				<span class="fa fa-play"></span>
			</button>
		</div>
		<div class="nav-tabs-menu">
			<button type="button" id="editorMenuDropdown" class="btn btn-primary btn-outline dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				<span class="fa fa-bars" data-string="aria-label|Menu"></span>
			</button>
			<ul class="dropdown-menu dropdown-menu-right">
				<li><a href="#" data-string="text|New" id="editorActionNew"><i class="fa fa-margin fa-file-o"></i></a></li>
				<li role="separator" class="divider"></li>
				<li><a href="#" data-string="text|LoadEllipsis" id="editorActionLoad"><i class="fa fa-margin fa-folder-open-o"></i></a></li>
				<li><a href="#" data-string="text|SaveEllipsis" id="editorActionSave"><i class="fa fa-margin fa-cloud-download"></i></a></li>
				<li role="separator" class="divider"></li>
				<li><a href="#" data-string="text|LoadExample" id="editorActionLoadExample"><i class="fa fa-margin fa-lightbulb-o"></i></a></li>
				<li role="separator" class="divider"></li>
				<li><a href="../" data-string="text|SimpleMode"><i class="fa fa-margin fa-edit"></i></a></li>
				<li id="editorActionInstallSeparator" role="separator" class="divider" style="display: none;"></li>
				<li id="editorActionInstallItem" style="display: none;"><a href="#" id="editorActionInstall" data-string="text|InstallHTML"><i class="fa fa-margin fa-download"></i></a></li>
				<li role="separator" class="divider"></li>
				<li><a href="#" data-string="text|LibrariesEllipsis" id="editorActionLibraries"><i class="fa fa-margin fa-code"></i></a></li>
			</ul>
			<div class="nav-tabs-file-load"><input id="editorActionFileLoad" tabindex="-1" type="file" accept="text/html" /></div>
		</div>
		<div class="editor-html-container"><textarea id="editor" class="editor-html" spellcheck="false" wrap="off"></textarea></div>
	</div>
	<div class="editor-bar" id="bar"></div>
	<iframe class="editor-iframe" id="iframe" frameborder="0"></iframe>

	<script type="text/javascript" src="../lib/jquery/jquery-1.0.0.min.js"></script>
	<script type="text/javascript" src="../lib/bootstrap/js/bootstrap-1.0.0.min.js"></script>
	<script type="text/javascript" src="../js/main.js"></script>

	<script type="text/javascript">
		"use strict";

		var installationPrompt = null;

		if (("serviceWorker" in navigator)) {
			window.addEventListener("beforeinstallprompt", function (e) {
				if (("preventDefault" in e))
					e.preventDefault();
				installationPrompt = e;
				_ID("editorActionInstallSeparator").style.display = "";
				_ID("editorActionInstallItem").style.display = "";
			});

			navigator.serviceWorker.register("../sw.js");
		}

		var loading = false,
			dirty = false,
			blobUrl = null,
			blobTimeout = 0,
			editorContainer = _ID("editorContainer"),
			editor = _ID("editor"),
			iframe = _ID("iframe");

		function loadFileDataURL(file, callback) {
			if (loading) {
				callback(null);
				return;
			}

			if (!("FileReader" in window)) {
				Notification.error(translate("ErrorNoFile"), true);
				callback(null);
				return;
			}

			loading = true;
			Notification.wait();

			var reader = new FileReader();
			reader.onload = function () {
				loading = false;
				Notification.hide();
				callback(reader.result);
			};
			reader.onerror = function () {
				loading = false;
				Notification.error(translate("ErrorFileLoad"), true);
				callback(null);
			};
			reader.readAsDataURL(file);
		}

		// Initial
		(function () {
			window.onbeforeunload = function () {
				return (dirty ? translate("ConfirmQuit") : null);
			};

			setTimeout(function () {
				document.body.style.visibility = "";

				editor.focus();

				if (!BlobDownloader.supported) {
					Notification.error(translate("ErrorNoFile"), true);
					return;
				}
			}, 250);
		})();

		// Actions Menu
		(function () {
			var editorActionFileLoad = _ID("editorActionFileLoad"),
				modalSaveFileName = _ID("modalSaveFileName"),
				modalSaveOk = _ID("modalSaveOk"),
				modalLibrariesText = _ID("modalLibrariesText");

			$("#modalSave").on("shown.bs.modal", function () {
				modalSaveFileName.focus();
			});

			$("#modalLibraries").on("shown.bs.modal", function () {
				modalLibrariesText.focus();
			});

			modalSaveFileName.onkeydown = function (e) {
				if (e.key === "Enter" || e.keyCode === 13)
					modalSaveOk.click();
			};

			function confirmClose() {
				return (!dirty || confirm(translate("ConfirmClose")));
			}

			function loadFileFromURL(url) {
				loading = true;
				Notification.wait();

				try {
					var xhr = new XMLHttpRequest(), done = false;
					xhr.responseType = "text";
					xhr.onreadystatechange = function () {
						if (xhr.readyState === 4) {
							if (done)
								return;
							done = true;

							loading = false;
							Notification.hide();

							try {
								loadDocument(xhr.responseText);
							} catch (ex) {
								Notification.error(translate("ErrorFileLoad"), true);
							}
						}
					};
					xhr.onerror = function () {
						loading = false;
						Notification.error(translate("ErrorFileLoad"), true);
					};
					xhr.open("get", url);
					xhr.send();
				} catch (ex) {
					loading = false;
					Notification.error(translate("ErrorFileLoad"), true);
				}
			}

			function loadFileFromInput() {
				if (loading)
					return;

				if (!("files" in editorActionFileLoad)) {
					Notification.error(translate("ErrorNoFile"), true);
					return;
				}

				if (!editorActionFileLoad.files.length || !editorActionFileLoad.files[0])
					return;

				loadFileDataURL(editorActionFileLoad.files[0], function (dataURL) {
					var parent = editorActionFileLoad.parentNode;
					editorActionFileLoad = _SA(_SA(_SA(_CE("input", null, _RC(parent, editorActionFileLoad)), "type", "file"), "tabindex", "-1"), "accept", "text/html");
					editorActionFileLoad.onchange = loadFileFromInput;

					if (!dataURL)
						return;

					if (dataURL.indexOf("data:text/html;base64,")) {
						Notification.error(translate("ErrorInvalidHTML"), true);
						return;
					}

					loadFileFromURL(dataURL);
				});
			}

			function previewPage() {
				if (loading)
					return;

				if (!BlobDownloader.supported) {
					Notification.error(translate("ErrorNoFile"), true);
					return;
				}

				if (blobUrl)
					URL.revokeObjectURL(blobUrl);

				if (blobTimeout)
					clearTimeout(blobTimeout);

				var blob = new Blob([
					new Uint8Array([0xEF, 0xBB, 0xBF]), // UTF-8 BOM
					editor.value
				], { type: "text/html;charset=utf-8" }), localBlobUrl = URL.createObjectURL(blob);

				_SA(iframe, "src", localBlobUrl);

				blobUrl = localBlobUrl;
				blobTimeout = setTimeout(function () {
					if (blobUrl === localBlobUrl) {
						URL.revokeObjectURL(blobUrl);
						blobUrl = null;
						blobTimeout = 0;
					}
				}, 5000);
			}

			function newDocument() {
				editor.value = '<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml" lang="' +
					window.language +
					'">\n<head>\n\t<meta charset="utf-8" />\n\t<meta name="viewport" content="width=device-width, initial-scale=1" />\n\t\n\t<title>' +
					translate("PageTitle") +
					'</title>\n\t\n\t<style type="text/css">\n\t\t\n\t</style>\n</head>\n<body>\n\t\n</body>\n</html>\n';

				dirty = false;

				previewPage();
			}

			function loadDocument(doc) {
				editor.value = doc;

				dirty = false;

				previewPage();
			}

			editorActionFileLoad.onchange = loadFileFromInput;

			_ID("editorPlay").onclick = previewPage;

			_ID("editorActionNew").onclick = function (e) {
				if (loading)
					return cancelEvent(e);

				$("#editorMenuDropdown").dropdown("toggle");

				if (!confirmClose())
					return cancelEvent(e);

				newDocument();

				return cancelEvent(e);
			};

			_ID("editorActionLoad").onclick = function (e) {
				if (loading)
					return cancelEvent(e);

				$("#editorMenuDropdown").dropdown("toggle");

				if (!confirmClose())
					return cancelEvent(e);

				editorActionFileLoad.click();

				return cancelEvent(e);
			};

			_ID("editorActionSave").onclick = function (e) {
				if (loading)
					return cancelEvent(e);

				$("#editorMenuDropdown").dropdown("toggle");

				$("#modalSave").modal({
					keyboard: true,
					backdrop: true
				});

				return cancelEvent(e);
			};

			_ID("editorActionLoadExample").onclick = function (e) {
				if (loading)
					return cancelEvent(e);

				$("#editorMenuDropdown").dropdown("toggle");

				if (!confirmClose())
					return cancelEvent(e);

				loadFileFromURL(translate("ExampleFileHTML"));

				return cancelEvent(e);
			};

			_ID("editorActionInstall").onclick = function (e) {
				$("#editorMenuDropdown").dropdown("toggle");

				_ID("editorActionInstallSeparator").style.display = "none";
				_ID("editorActionInstallItem").style.display = "none";

				if (installationPrompt) {
					installationPrompt.prompt();
					installationPrompt = null;
				}

				return cancelEvent(e);
			};

			_ID("editorActionLibraries").onclick = function (e) {
				if (loading)
					return cancelEvent(e);

				$("#editorMenuDropdown").dropdown("toggle");

				$("#modalLibraries").modal({
					keyboard: true,
					backdrop: true
				});

				return cancelEvent(e);
			};

			modalSaveOk.onclick = function () {
				var fileName = trim(modalSaveFileName.value);
				if (!fileName)
					return;

				if (!BlobDownloader.supported) {
					Notification.error(translate("ErrorNoFile"), true);
					return;
				}

				if (fileName.toLowerCase().indexOf(".htm") < 0)
					fileName += ".html";

				$("#modalSave").modal("hide");

				BlobDownloader.download(fileName, new Blob([
					new Uint8Array([0xEF, 0xBB, 0xBF]), // UTF-8 BOM
					editor.value
				], { type: "text/html;charset=utf-8" }));

				dirty = false;
			};

			newDocument();

		})();
	</script>
</body>
</html>
